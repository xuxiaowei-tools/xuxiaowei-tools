import{a as t,R as e,F as r,M as n,c as i}from"./prosemirror-model-472169a6.js";const s=Math.pow(2,16);function o(t){return 65535&t}class l{constructor(t,e,r){this.pos=t,this.delInfo=e,this.recover=r}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class p{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&p.empty)return p.empty}recover(t){let e=0,r=o(t);if(!this.inverted)for(let n=0;n<r;n++)e+=this.ranges[3*n+2]-this.ranges[3*n+1];return this.ranges[3*r]+e+function(t){return(t-(65535&t))/s}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,r){let n=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let p=0;p<this.ranges.length;p+=3){let a=this.ranges[p]-(this.inverted?n:0);if(a>t)break;let h=this.ranges[p+i],c=this.ranges[p+o],f=a+h;if(t<=f){let i=a+n+((h?t==a?-1:t==f?1:e:e)<0?0:c);if(r)return i;let o=t==(e<0?a:f)?null:p/3+(t-a)*s,d=t==a?2:t==f?1:4;return(e<0?t!=a:t!=f)&&(d|=8),new l(i,d,o)}n+=c-h}return r?t+n:new l(t+n,0,null)}touches(t,e){let r=0,n=o(e),i=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let e=this.ranges[o]-(this.inverted?r:0);if(e>t)break;let l=this.ranges[o+i];if(t<=e+l&&o==3*n)return!0;r+=this.ranges[o+s]-l}return!1}forEach(t){let e=this.inverted?2:1,r=this.inverted?1:2;for(let n=0,i=0;n<this.ranges.length;n+=3){let s=this.ranges[n],o=s-(this.inverted?i:0),l=s+(this.inverted?0:i),p=this.ranges[n+e],a=this.ranges[n+r];t(o,o+p,l,l+a),i+=a-p}}invert(){return new p(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?p.empty:new p(t<0?[0,-t,0]:[0,0,t])}}p.empty=new p([]);class a{constructor(t=[],e,r=0,n=t.length){this.maps=t,this.mirror=e,this.from=r,this.to=n}slice(t=0,e=this.maps.length){return new a(this.maps,this.mirror,t,e)}copy(){return new a(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,r=this.maps.length;e<t.maps.length;e++){let n=t.getMirror(e);this.appendMap(t.maps[e],null!=n&&n<e?r+n:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,r=this.maps.length+t.maps.length;e>=0;e--){let n=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=n&&n>e?r-n-1:void 0)}}invert(){let t=new a;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let r=this.from;r<this.to;r++)t=this.maps[r].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,r){let n=0;for(let i=this.from;i<this.to;i++){let r=this.maps[i].mapResult(t,e);if(null!=r.recover){let e=this.getMirror(i);if(null!=e&&e>i&&e<this.to){i=e,t=this.maps[e].recover(r.recover);continue}}n|=r.delInfo,t=r.pos}return r?t:new l(t,n,null)}}const h=Object.create(null);class c{getMap(){return p.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=h[e.stepType];if(!r)throw new RangeError(`No step type ${e.stepType} defined`);return r.fromJSON(t,e)}static jsonID(t,e){if(t in h)throw new RangeError("Duplicate use of step JSON ID "+t);return h[t]=e,e.prototype.jsonID=t,e}}class f{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new f(t,null)}static fail(t){return new f(null,t)}static fromReplace(t,r,n,i){try{return f.ok(t.replace(r,n,i))}catch(s){if(s instanceof e)return f.fail(s.message);throw s}}}function d(t,e,n){let i=[];for(let r=0;r<t.childCount;r++){let s=t.child(r);s.content.size&&(s=s.copy(d(s.content,e,s))),s.isInline&&(s=e(s,n,r)),i.push(s)}return r.fromArray(i)}class u extends c{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(e){let r=e.slice(this.from,this.to),n=e.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new t(d(r.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),i),r.openStart,r.openEnd);return f.fromReplace(e,this.from,this.to,s)}invert(){return new m(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new u(e.pos,r.pos,this.mark)}merge(t){return t instanceof u&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new u(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new u(e.from,e.to,t.markFromJSON(e.mark))}}c.jsonID("addMark",u);class m extends c{constructor(t,e,r){super(),this.from=t,this.to=e,this.mark=r}apply(e){let r=e.slice(this.from,this.to),n=new t(d(r.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),e),r.openStart,r.openEnd);return f.fromReplace(e,this.from,this.to,n)}invert(){return new u(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deleted&&r.deleted||e.pos>=r.pos?null:new m(e.pos,r.pos,this.mark)}merge(t){return t instanceof m&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new m(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new m(e.from,e.to,t.markFromJSON(e.mark))}}c.jsonID("removeMark",m);class g extends c{constructor(t,e){super(),this.pos=t,this.mark=e}apply(e){let n=e.nodeAt(this.pos);if(!n)return f.fail("No node at mark step's position");let i=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return f.fromReplace(e,this.pos,this.pos+1,new t(r.from(i),0,n.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let r=0;r<e.marks.length;r++)if(!e.marks[r].isInSet(t))return new g(this.pos,e.marks[r]);return new g(this.pos,this.mark)}}return new y(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new g(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new g(e.pos,t.markFromJSON(e.mark))}}c.jsonID("addNodeMark",g);class y extends c{constructor(t,e){super(),this.pos=t,this.mark=e}apply(e){let n=e.nodeAt(this.pos);if(!n)return f.fail("No node at mark step's position");let i=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return f.fromReplace(e,this.pos,this.pos+1,new t(r.from(i),0,n.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new g(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new y(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new y(e.pos,t.markFromJSON(e.mark))}}c.jsonID("removeNodeMark",y);class w extends c{constructor(t,e,r,n=!1){super(),this.from=t,this.to=e,this.slice=r,this.structure=n}apply(t){return this.structure&&v(t,this.from,this.to)?f.fail("Structure replace would overwrite content"):f.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new p([this.from,this.to-this.from,this.slice.size])}invert(t){return new w(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return e.deletedAcross&&r.deletedAcross?null:new w(e.pos,Math.max(e.pos,r.pos),this.slice)}merge(e){if(!(e instanceof w)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let r=this.slice.size+e.slice.size==0?t.empty:new t(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new w(e.from,this.to,r,this.structure)}}{let r=this.slice.size+e.slice.size==0?t.empty:new t(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new w(this.from,this.to+(e.to-e.from),r,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(e,r){if("number"!=typeof r.from||"number"!=typeof r.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new w(r.from,r.to,t.fromJSON(e,r.slice),!!r.structure)}}c.jsonID("replace",w);class k extends c{constructor(t,e,r,n,i,s,o=!1){super(),this.from=t,this.to=e,this.gapFrom=r,this.gapTo=n,this.slice=i,this.insert=s,this.structure=o}apply(t){if(this.structure&&(v(t,this.from,this.gapFrom)||v(t,this.gapTo,this.to)))return f.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return f.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,e.content);return r?f.fromReplace(t,this.from,this.to,r):f.fail("Content does not fit in gap")}getMap(){return new p([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new k(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),n=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&r.deletedAcross||n<e.pos||i>r.pos?null:new k(e.pos,r.pos,n,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(e,r){if("number"!=typeof r.from||"number"!=typeof r.to||"number"!=typeof r.gapFrom||"number"!=typeof r.gapTo||"number"!=typeof r.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new k(r.from,r.to,r.gapFrom,r.gapTo,t.fromJSON(e,r.slice),r.insert,!!r.structure)}}function v(t,e,r){let n=t.resolve(e),i=r-e,s=n.depth;for(;i>0&&s>0&&n.indexAfter(s)==n.node(s).childCount;)s--,i--;if(i>0){let t=n.node(s).maybeChild(n.indexAfter(s));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}function S(t,e,r){return(0==e||t.canReplace(e,t.childCount))&&(r==t.childCount||t.canReplace(0,r))}function M(t){let e=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let n=t.$from.node(r),i=t.$from.index(r),s=t.$to.indexAfter(r);if(r<t.depth&&n.canReplace(i,s,e))return r;if(0==r||n.type.spec.isolating||!S(n,i,s))break}return null}function N(t,e,r=null,n=t){let i=function(t,e){let{parent:r,startIndex:n,endIndex:i}=t,s=r.contentMatchAt(n).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return r.canReplaceWith(n,i,o)?s:null}(t,e),s=i&&function(t,e){let{parent:r,startIndex:n,endIndex:i}=t,s=r.child(n),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let p=n;l&&p<i;p++)l=l.matchType(r.child(p).type);return l&&l.validEnd?o:null}(n,e);return s?i.map(R).concat({type:e,attrs:r}).concat(s.map(R)):null}function R(t){return{type:t,attrs:null}}function C(t,e,r=1,n){let i=t.resolve(e),s=i.depth-r,o=n&&n[n.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let a=i.depth-1,h=r-2;a>s;a--,h--){let t=i.node(a),e=i.index(a);if(t.type.spec.isolating)return!1;let r=t.content.cutByIndex(e,t.childCount),s=n&&n[h]||t;if(s!=t&&(r=r.replaceChild(0,s.type.create(s.attrs))),!t.canReplace(e+1,t.childCount)||!s.type.validContent(r))return!1}let l=i.indexAfter(s),p=n&&n[0];return i.node(s).canReplaceWith(l,l,p?p.type:i.node(s+1).type)}function x(t,e){let r=t.resolve(e),n=r.index();return i=r.nodeBefore,s=r.nodeAfter,!(!i||!s||i.isLeaf||!i.canAppend(s))&&r.parent.canReplace(n,n+1);var i,s}function b(t,e,r){let n=t.resolve(e);if(!r.content.size)return e;let i=r.content;for(let s=0;s<r.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(0==r.openStart&&r.size?2:1);s++)for(let t=n.depth;t>=0;t--){let e=t==n.depth?0:n.pos<=(n.start(t+1)+n.end(t+1))/2?-1:1,r=n.index(t)+(e>0?1:0),o=n.node(t),l=!1;if(1==s)l=o.canReplace(r,r,i);else{let t=o.contentMatchAt(r).findWrapping(i.firstChild.type);l=t&&o.canReplaceWith(r,r,t[0])}if(l)return 0==e?n.pos:e<0?n.before(t+1):n.after(t+1)}return null}function I(e,r,n=r,i=t.empty){if(r==n&&!i.size)return null;let s=e.resolve(r),o=e.resolve(n);return T(s,o,i)?new w(r,n,i):new O(s,o,i).fit()}function T(t,e,r){return!r.openStart&&!r.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),r.content)}c.jsonID("replaceAround",k);class O{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=r.empty;for(let r=0;r<=t.depth;r++){let e=t.node(r);this.frontier.push({type:e.type,match:e.contentMatchAt(t.indexAfter(r))})}for(let i=t.depth;i>0;i--)this.placed=r.from(t.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),r=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(e<0?this.$to:n.doc.resolve(e));if(!i)return null;let s=this.placed,o=n.depth,l=i.depth;for(;o&&l&&1==s.childCount;)s=s.firstChild.content,o--,l--;let p=new t(s,o,l);return e>-1?new k(n.pos,e,this.$to.pos,this.$to.end(),p,r):p.size||n.pos!=this.$to.pos?new w(n.pos,i.pos,p):null}findFittable(){for(let t=1;t<=2;t++)for(let e=this.unplaced.openStart;e>=0;e--){let n,i=null;e?(i=J(this.unplaced.content,e-1).firstChild,n=i.content):n=this.unplaced.content;let s=n.firstChild;for(let o=this.depth;o>=0;o--){let n,{type:l,match:p}=this.frontier[o],a=null;if(1==t&&(s?p.matchType(s.type)||(a=p.fillBefore(r.from(s),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:e,frontierDepth:o,parent:i,inject:a};if(2==t&&s&&(n=p.findWrapping(s.type)))return{sliceDepth:e,frontierDepth:o,parent:i,wrap:n};if(i&&p.matchType(i.type))break}}}openMore(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=J(e,r);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new t(e,r+1,Math.max(n,i.size+r>=e.size-n?r+1:0)),!0)}dropNode(){let{content:e,openStart:r,openEnd:n}=this.unplaced,i=J(e,r);if(i.childCount<=1&&r>0){let s=e.size-r<=r+i.size;this.unplaced=new t(A(e,r-1,1),r-1,s?r-1:n)}else this.unplaced=new t(A(e,r,1),r,n)}placeNodes({sliceDepth:e,frontierDepth:n,parent:i,inject:s,wrap:o}){for(;this.depth>n;)this.closeFrontierNode();if(o)for(let t=0;t<o.length;t++)this.openFrontierNode(o[t]);let l=this.unplaced,p=i?i.content:l.content,a=l.openStart-e,h=0,c=[],{match:f,type:d}=this.frontier[n];if(s){for(let t=0;t<s.childCount;t++)c.push(s.child(t));f=f.matchFragment(s)}let u=p.size+e-(l.content.size-l.openEnd);for(;h<p.childCount;){let t=p.child(h),e=f.matchType(t.type);if(!e)break;h++,(h>1||0==a||t.content.size)&&(f=e,c.push(z(t.mark(d.allowedMarks(t.marks)),1==h?a:0,h==p.childCount?u:-1)))}let m=h==p.childCount;m||(u=-1),this.placed=E(this.placed,n,r.from(c)),this.frontier[n].match=f,m&&u<0&&i&&i.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let t=0,r=p;t<u;t++){let t=r.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),r=t.content}this.unplaced=m?0==e?t.empty:new t(A(l.content,e-1,1),e-1,u<0?l.openEnd:e-1):new t(A(l.content,e,h),l.openStart,l.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!F(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:r}=this.$to,n=this.$to.after(r);for(;r>1&&n==this.$to.end(--r);)++n;return n}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:r,type:n}=this.frontier[e],i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=F(t,e,n,r,i);if(s){for(let r=e-1;r>=0;r--){let{match:e,type:n}=this.frontier[r],i=F(t,r,n,e,!0);if(!i||i.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=E(this.placed,e.depth,e.fit)),t=e.move;for(let r=e.depth+1;r<=t.depth;r++){let e=t.node(r),n=e.type.contentMatch.fillBefore(e.content,!0,t.index(r));this.openFrontierNode(e.type,e.attrs,n)}return t}openFrontierNode(t,e=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=E(this.placed,this.depth,r.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(r.empty,!0);t.childCount&&(this.placed=E(this.placed,this.frontier.length,t))}}function A(t,e,r){return 0==e?t.cutByIndex(r,t.childCount):t.replaceChild(0,t.firstChild.copy(A(t.firstChild.content,e-1,r)))}function E(t,e,r){return 0==e?t.append(r):t.replaceChild(t.childCount-1,t.lastChild.copy(E(t.lastChild.content,e-1,r)))}function J(t,e){for(let r=0;r<e;r++)t=t.firstChild.content;return t}function z(t,e,n){if(e<=0)return t;let i=t.content;return e>1&&(i=i.replaceChild(0,z(i.firstChild,e-1,1==i.childCount?n-1:0))),e>0&&(i=t.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(t.type.contentMatch.matchFragment(i).fillBefore(r.empty,!0)))),t.copy(i)}function F(t,e,r,n,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!r.compatibleContent(s.type))return null;let l=n.fillBefore(s.content,!0,o);return l&&!function(t,e,r){for(let n=r;n<e.childCount;n++)if(!t.allowsMarks(e.child(n).marks))return!0;return!1}(r,s.content,o)?l:null}function $(t){return t.spec.defining||t.spec.definingForContent}function B(t,e,n,i,s){if(e<n){let r=t.firstChild;t=t.replaceChild(0,r.copy(B(r.content,e+1,n,i,r)))}if(e>i){let e=s.contentMatchAt(0),n=e.fillBefore(t).append(t);t=n.append(e.matchFragment(n).fillBefore(r.empty,!0))}return t}function D(t,e){let r=[];for(let n=Math.min(t.depth,e.depth);n>=0;n--){let i=t.start(n);if(i<t.pos-(t.depth-n)||e.end(n)>e.pos+(e.depth-n)||t.node(n).type.spec.isolating||e.node(n).type.spec.isolating)break;(i==e.start(n)||n==t.depth&&n==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&n&&e.start(n-1)==i-1)&&r.push(n)}return r}class W extends c{constructor(t,e,r){super(),this.pos=t,this.attr=e,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return f.fail("No node at attribute step's position");let i=Object.create(null);for(let t in n.attrs)i[t]=n.attrs[t];i[this.attr]=this.value;let s=n.type.create(i,null,n.marks);return f.fromReplace(e,this.pos,this.pos+1,new t(r.from(s),0,n.isLeaf?0:1))}getMap(){return p.empty}invert(t){return new W(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new W(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new W(e.pos,e.attr,e.value)}}c.jsonID("attr",W);let j=class extends Error{};j=function t(e){let r=Error.call(this,e);return r.__proto__=t.prototype,r},(j.prototype=Object.create(Error.prototype)).constructor=j,j.prototype.name="TransformError";class L{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new a}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new j(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(e,r=e,n=t.empty){let i=I(this.doc,e,r,n);return i&&this.step(i),this}replaceWith(e,n,i){return this.replace(e,n,new t(r.from(i),0,0))}delete(e,r){return this.replace(e,r,t.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(e,r,n){return function(e,r,n,i){if(!i.size)return e.deleteRange(r,n);let s=e.doc.resolve(r),o=e.doc.resolve(n);if(T(s,o,i))return e.step(new w(r,n,i));let l=D(s,e.doc.resolve(n));0==l[l.length-1]&&l.pop();let p=-(s.depth+1);l.unshift(p);for(let t=s.depth,d=s.pos-1;t>0;t--,d--){let e=s.node(t).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;l.indexOf(t)>-1?p=t:s.before(t)==d&&l.splice(1,0,-t)}let a=l.indexOf(p),h=[],c=i.openStart;for(let t=i.content,d=0;;d++){let e=t.firstChild;if(h.push(e),d==i.openStart)break;t=e.content}for(let t=c-1;t>=0;t--){let e=h[t].type,r=$(e);if(r&&s.node(a).type!=e)c=t;else if(r||!e.isTextblock)break}for(let d=i.openStart;d>=0;d--){let r=(d+c+1)%(i.openStart+1),p=h[r];if(p)for(let h=0;h<l.length;h++){let c=l[(h+a)%l.length],f=!0;c<0&&(f=!1,c=-c);let d=s.node(c-1),u=s.index(c-1);if(d.canReplaceWith(u,u,p.type,p.marks))return e.replace(s.before(c),f?o.after(c):n,new t(B(i.content,0,i.openStart,r),r,i.openEnd))}}let f=e.steps.length;for(let t=l.length-1;t>=0&&(e.replace(r,n,i),!(e.steps.length>f));t--){let e=l[t];e<0||(r=s.before(e),n=o.after(e))}}(this,e,r,n),this}replaceRangeWith(e,n,i){return function(e,n,i,s){if(!s.isInline&&n==i&&e.doc.resolve(n).parent.content.size){let t=function(t,e,r){let n=t.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),r))return e;if(0==n.parentOffset)for(let i=n.depth-1;i>=0;i--){let t=n.index(i);if(n.node(i).canReplaceWith(t,t,r))return n.before(i+1);if(t>0)return null}if(n.parentOffset==n.parent.content.size)for(let i=n.depth-1;i>=0;i--){let t=n.indexAfter(i);if(n.node(i).canReplaceWith(t,t,r))return n.after(i+1);if(t<n.node(i).childCount)return null}return null}(e.doc,n,s.type);null!=t&&(n=i=t)}e.replaceRange(n,i,new t(r.from(s),0,0))}(this,e,n,i),this}deleteRange(t,e){return function(t,e,r){let n=t.doc.resolve(e),i=t.doc.resolve(r),s=D(n,i);for(let o=0;o<s.length;o++){let e=s[o],r=o==s.length-1;if(r&&0==e||n.node(e).type.contentMatch.validEnd)return t.delete(n.start(e),i.end(e));if(e>0&&(r||n.node(e-1).canReplace(n.index(e-1),i.indexAfter(e-1))))return t.delete(n.before(e),i.after(e))}for(let o=1;o<=n.depth&&o<=i.depth;o++)if(e-n.start(o)==n.depth-o&&r>n.end(o)&&i.end(o)-r!=i.depth-o)return t.delete(n.before(o),r);t.delete(e,r)}(this,t,e),this}lift(e,n){return function(e,n,i){let{$from:s,$to:o,depth:l}=n,p=s.before(l+1),a=o.after(l+1),h=p,c=a,f=r.empty,d=0;for(let t=l,g=!1;t>i;t--)g||s.index(t)>0?(g=!0,f=r.from(s.node(t).copy(f)),d++):h--;let u=r.empty,m=0;for(let t=l,g=!1;t>i;t--)g||o.after(t+1)<o.end(t)?(g=!0,u=r.from(o.node(t).copy(u)),m++):c++;e.step(new k(h,c,p,a,new t(f.append(u),d,m),f.size-d,!0))}(this,e,n),this}join(e,r=1){return function(e,r,n){let i=new w(r-n,r+n,t.empty,!0);e.step(i)}(this,e,r),this}wrap(e,n){return function(e,n,i){let s=r.empty;for(let t=i.length-1;t>=0;t--){if(s.size){let e=i[t].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=r.from(i[t].type.create(i[t].attrs,s))}let o=n.start,l=n.end;e.step(new k(o,l,o,l,new t(s,0,0),i.length,!0))}(this,e,n),this}setBlockType(e,n=e,i,s=null){return function(e,n,i,s,o){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let l=e.steps.length;e.doc.nodesBetween(n,i,((n,i)=>{if(n.isTextblock&&!n.hasMarkup(s,o)&&function(t,e,r){let n=t.resolve(e),i=n.index();return n.parent.canReplaceWith(i,i+1,r)}(e.doc,e.mapping.slice(l).map(i),s)){e.clearIncompatible(e.mapping.slice(l).map(i,1),s);let p=e.mapping.slice(l),a=p.map(i,1),h=p.map(i+n.nodeSize,1);return e.step(new k(a,h,a+1,h-1,new t(r.from(s.create(o,null,n.marks)),0,0),1,!0)),!1}}))}(this,e,n,i,s),this}setNodeMarkup(e,n,i=null,s=[]){return function(e,n,i,s,o){let l=e.doc.nodeAt(n);if(!l)throw new RangeError("No node at given position");i||(i=l.type);let p=i.create(s,null,o||l.marks);if(l.isLeaf)return e.replaceWith(n,n+l.nodeSize,p);if(!i.validContent(l.content))throw new RangeError("Invalid content for node type "+i.name);e.step(new k(n,n+l.nodeSize,n+1,n+l.nodeSize-1,new t(r.from(p),0,0),1,!0))}(this,e,n,i,s),this}setNodeAttribute(t,e,r){return this.step(new W(t,e,r)),this}addNodeMark(t,e){return this.step(new g(t,e)),this}removeNodeMark(t,e){if(!(e instanceof n)){let r=this.doc.nodeAt(t);if(!r)throw new RangeError("No node at position "+t);if(!(e=e.isInSet(r.marks)))return this}return this.step(new y(t,e)),this}split(e,n=1,i){return function(e,n,i=1,s){let o=e.doc.resolve(n),l=r.empty,p=r.empty;for(let t=o.depth,a=o.depth-i,h=i-1;t>a;t--,h--){l=r.from(o.node(t).copy(l));let e=s&&s[h];p=r.from(e?e.type.create(e.attrs,p):o.node(t).copy(p))}e.step(new w(n,n,new t(l.append(p),i,i),!0))}(this,e,n,i),this}addMark(t,e,r){return function(t,e,r,n){let i,s,o=[],l=[];t.doc.nodesBetween(e,r,((t,p,a)=>{if(!t.isInline)return;let h=t.marks;if(!n.isInSet(h)&&a.type.allowsMarkType(n.type)){let a=Math.max(p,e),c=Math.min(p+t.nodeSize,r),f=n.addToSet(h);for(let t=0;t<h.length;t++)h[t].isInSet(f)||(i&&i.to==a&&i.mark.eq(h[t])?i.to=c:o.push(i=new m(a,c,h[t])));s&&s.to==a?s.to=c:l.push(s=new u(a,c,n))}})),o.forEach((e=>t.step(e))),l.forEach((e=>t.step(e)))}(this,t,e,r),this}removeMark(t,e,r){return function(t,e,r,n){let s=[],o=0;t.doc.nodesBetween(e,r,((t,l)=>{if(!t.isInline)return;o++;let p=null;if(n instanceof i){let e,r=t.marks;for(;e=n.isInSet(r);)(p||(p=[])).push(e),r=e.removeFromSet(r)}else n?n.isInSet(t.marks)&&(p=[n]):p=t.marks;if(p&&p.length){let n=Math.min(l+t.nodeSize,r);for(let t=0;t<p.length;t++){let r,i=p[t];for(let t=0;t<s.length;t++){let e=s[t];e.step==o-1&&i.eq(s[t].style)&&(r=e)}r?(r.to=n,r.step=o):s.push({style:i,from:Math.max(l,e),to:n,step:o})}}})),s.forEach((e=>t.step(new m(e.from,e.to,e.style))))}(this,t,e,r),this}clearIncompatible(e,n,i){return function(e,n,i,s=i.contentMatch){let o=e.doc.nodeAt(n),l=[],p=n+1;for(let r=0;r<o.childCount;r++){let n=o.child(r),a=p+n.nodeSize,h=s.matchType(n.type);if(h){s=h;for(let t=0;t<n.marks.length;t++)i.allowsMarkType(n.marks[t].type)||e.step(new m(p,a,n.marks[t]))}else l.push(new w(p,a,t.empty));p=a}if(!s.validEnd){let n=s.fillBefore(r.empty,!0);e.replace(p,p,new t(n,0,0))}for(let t=l.length-1;t>=0;t--)e.step(l[t])}(this,e,n,i),this}}export{a as M,k as R,p as S,L as T,x as a,w as b,C as c,b as d,N as f,M as l,I as r};
