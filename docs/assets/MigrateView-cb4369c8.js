import{d as e,a as l,b as a,k as t,l as o,h as u,g as r}from"./element-plus-a17310d1.js";import{a as s}from"./clipboard-b18db9e2.js";import{d as n,c as i}from"./pinia-2a9439bb.js";import{r as c,u as p}from"./@vue-67bd3c9a.js";import{k as v,w as d,o as m,c as f,A as k,y as b,K as g,x as y,t as j,F as _,Y as h,Z as $,a as x}from"./vue-e1fd4543.js";import{_ as V}from"./index-0e558578.js";import"./@vueuse-cc804279.js";import"./@popperjs-b78c3215.js";import"./@element-plus-893dda61.js";import"./lodash-es-7b2175ad.js";import"./memoize-one-63ab667a.js";import"./@ctrl-a951068a.js";import"./vue-clipboard3-12a5795a.js";import"./clipboard-b5f6a829.js";import"./bcryptjs-638ef99f.js";import"./vue-router-c701b404.js";const w=n("dockerImagesMigrate",{state:()=>({images:c("jimmidyson/configmap-reload:v0.5.0\ngrafana/grafana:9.3.2\n   \n   \n  quay.io/brancz/kube-rbac-proxy:v0.14.0\n   \n  quay.io/prometheus/node-exporter:v1.5.0   \n registry.k8s.io/prometheus-adapter/prometheus-adapter:v0.10.0 \n \n\nquay.io/prometheus-operator/prometheus-operator:v0.62.0       \n   \n    \n "),type:c("1"),repositoryUrl:c("registry.jihulab.com/xuxiaowei-cloud/xuxiaowei-cloud")}),getters:{},actions:{setImages(e){this.images=e},setType(e){this.type=e},setRepositoryUrl(e){this.repositoryUrl=e}}})(i());w.$subscribe(((e,l)=>{localStorage.setItem(w.$id,JSON.stringify({...l}))}));const U=localStorage.getItem(w.$id);U&&(w.$state=JSON.parse(U));const A=e=>(h("data-v-58d14b7c"),e=e(),$(),e),D=A((()=>x("h1",null,"Docker 镜像迁移",-1))),I=A((()=>x("li",null,"从一台机器中的镜像迁移到另外一台机器上",-1))),q=A((()=>x("li",null,"离线安装 kubernetes（k8s） 镜像导入命令",-1))),S=A((()=>x("li",null,"下载国外镜像，推送到国内镜像网站，实现镜像下载自由",-1))),T=A((()=>x("br",null,null,-1))),z=A((()=>x("br",null,null,-1))),C=A((()=>x("br",null,null,-1))),J=A((()=>x("br",null,null,-1))),M=A((()=>x("br",null,null,-1))),N=V(v({__name:"MigrateView",setup(n){const i=c(w.type);d((()=>i.value),((e,l)=>{w.setType(e)}));const v=c(w.repositoryUrl);d((()=>v.value),((e,l)=>{w.setRepositoryUrl(e)}));const h=c(w.images);d((()=>h.value),((e,l)=>{w.setImages(e)}));const $=c([]),x=c(""),V=c(0),U=c(16),A=e=>{const l=e.split("/");return l[0].includes(".")?l.slice(1).join("/"):e},N=()=>{if("1"===i.value);else if(""===v.value)return void e.error("仓库地址不能为空");const l=h.value.split("\n");$.value=[],x.value="",V.value=0;for(const e of l){const l=e.trim();""!==l&&($.value.push(l),V.value++)}x.value+="\n# 拉取 docker 镜像命令\n";for(const e of $.value)x.value+=`docker pull ${e} \n`,V.value++;"1"===i.value?(()=>{x.value+="\n# 将 docker 镜像保存成文件的命令\n";for(const e of $.value)x.value+=`docker save -o ${e.replaceAll("/","-").replaceAll(":","-")}.tar ${e} \n`,V.value++;x.value+="\n# 将上面得到的结果上传到需要导入镜像的服务器上\n",x.value+="\n# docker 导入镜像命令\n";for(const e of $.value)x.value+=`docker load -i ${e.replaceAll("/","-").replaceAll(":","-")}.tar \n`,V.value++;x.value+="\n# kubernetes（k8s） 导入镜像命令\n";for(const e of $.value)x.value+=`ctr -n=k8s.io image import ${e.replaceAll("/","-").replaceAll(":","-")}.tar \n`,V.value++})():(()=>{x.value+="\n# 镜像重名到自己的仓库\n";for(const e of $.value)x.value+=`docker tag ${e} ${v.value}/${A(e)} \n`,V.value++;x.value+="\n# 请先登录 Docker 仓库后再执行推送命令\n",x.value+="\n# 镜像推送到自己的仓库\n";for(const e of $.value)x.value+=`docker push ${v.value}/${A(e)} \n`,V.value++;x.value+="\n# 将上面推送到自己仓库的镜像拉取到需要导入镜像的服务器中，并恢复原始名称\n",x.value+="\n# kubernetes（k8s） 拉取镜像 \n";for(const e of $.value)x.value+=`ctr -n=k8s.io image pull ${v.value}/${A(e)} \n`,V.value++;x.value+="\n# kubernetes（k8s） 恢复原始镜像名称 \n";for(const e of $.value)x.value+=`ctr -n=k8s.io image tag ${v.value}/${A(e)} ${e} \n`,V.value++})(),U.value=V.value+16};return(e,n)=>{const c=l,d=a,$=t,V=o,w=u,A=r;return m(),f(_,null,[k(d,{justify:"space-evenly"},{default:b((()=>[k(c,{span:22,class:"text-center"},{default:b((()=>[D,I,q,S])),_:1})])),_:1}),T,k(d,{class:"text-center"},{default:b((()=>[k(c,{span:22},{default:b((()=>[k(V,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=e=>i.value=e)},{default:b((()=>[k($,{border:"",label:"1"},{default:b((()=>[g("人工迁移命令")])),_:1}),k($,{border:"",label:"2"},{default:b((()=>[g("仓库迁移命令")])),_:1})])),_:1},8,["modelValue"])])),_:1})])),_:1}),z,k(d,{justify:"center",gutter:20},{default:b((()=>[k(c,{span:22},{default:b((()=>[k(w,{onClick:N,class:"get-command-button"},{default:b((()=>[g("获取命令")])),_:1})])),_:1})])),_:1}),C,"1"!==i.value?(m(),y(d,{key:0,justify:"center",gutter:20},{default:b((()=>[k(c,{span:22},{default:b((()=>[k(A,{placeholder:"仓库地址，如：registry.jihulab.com/xuxiaowei-cloud/xuxiaowei-cloud",modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=e=>v.value=e)},null,8,["modelValue"])])),_:1})])),_:1})):j("",!0),J,k(d,{justify:"center",gutter:20},{default:b((()=>[k(c,{span:22},{default:b((()=>[k(A,{modelValue:h.value,"onUpdate:modelValue":n[2]||(n[2]=e=>h.value=e),class:"token-input",placeholder:"请填写镜像名称，每行一个镜像",type:"textarea",onDblclick:p(s),rows:"16"},null,8,["modelValue","onDblclick"])])),_:1})])),_:1}),M,k(d,{justify:"center",gutter:20},{default:b((()=>[k(c,{span:22},{default:b((()=>[k(A,{modelValue:x.value,"onUpdate:modelValue":n[3]||(n[3]=e=>x.value=e),class:"token-input",placeholder:"结果",type:"textarea",onDblclick:p(s),rows:U.value,"data-dblclick":"结果已复制到剪贴板"},null,8,["modelValue","onDblclick","rows"])])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-58d14b7c"]]);export{N as default};
