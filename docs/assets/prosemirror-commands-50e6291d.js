import{f as e,r as t,R as n,a as o,l as r,c as l}from"./prosemirror-transform-c2f93e29.js";import{F as i,a as s}from"./prosemirror-model-472169a6.js";import{S as c,N as a,A as p,T as f}from"./prosemirror-state-5b4308dd.js";const d=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function u(e,t,n=!1){for(let o=e;o;o="start"==t?o.firstChild:o.lastChild){if(o.isTextblock)return!0;if(n&&1!=o.childCount)return!1}return!1}function m(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}const h=(e,n,o)=>{let r=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}(e,o);if(!r)return!1;let l=g(r);if(!l)return!1;let i=l.nodeAfter;if(S(e,l,n))return!0;if(0==r.parent.content.size&&(u(i,"start")||a.isSelectable(i))){let o=t(e.doc,r.before(),r.after(),s.empty);if(o&&o.slice.size<o.to-o.from){if(n){let t=e.tr.step(o);t.setSelection(u(i,"start")?c.findFrom(t.doc.resolve(t.mapping.map(l.pos)),1):a.create(t.doc,t.mapping.map(l.pos))),n(t.scrollIntoView())}return!0}}return!(!i.isAtom||l.depth!=r.depth-1)&&(n&&n(e.tr.delete(l.pos,l.pos+i.nodeSize).scrollIntoView()),!0)};function g(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const k=(e,t)=>{let{$head:n,$anchor:o}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(o))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function w(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const y=(e,t)=>{let{$head:n,$anchor:o}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;let r=n.node(-1),l=n.indexAfter(-1),i=w(r.contentMatchAt(l));if(!i||!r.canReplaceWith(l,l,i))return!1;if(t){let o=n.after(),r=e.tr.replaceWith(o,o,i.createAndFill());r.setSelection(c.near(r.doc.resolve(o),1)),t(r.scrollIntoView())}return!0};const b=(e,t)=>{let{$from:n,$to:o}=e.selection;if(e.selection instanceof a&&e.selection.node.isBlock)return!(!n.parentOffset||!l(e.doc,n.pos)||(t&&t(e.tr.split(n.pos).scrollIntoView()),0));if(!n.parent.isBlock)return!1;if(t){let r=o.parentOffset==o.parent.content.size,i=e.tr;(e.selection instanceof f||e.selection instanceof p)&&i.deleteSelection();let s=0==n.depth?null:w(n.node(-1).contentMatchAt(n.indexAfter(-1))),c=x&&x(o.parent,r),a=c?[c]:r&&s?[{type:s}]:void 0,d=l(i.doc,i.mapping.map(n.pos),1,a);if(a||d||!l(i.doc,i.mapping.map(n.pos),1,s?[{type:s}]:void 0)||(s&&(a=[{type:s}]),d=!0),d&&(i.split(i.mapping.map(n.pos),1,a),!r&&!n.parentOffset&&n.parent.type!=s)){let e=i.mapping.map(n.before()),t=i.doc.resolve(e);s&&n.node(-1).canReplaceWith(t.index(),t.index()+1,s)&&i.setNodeMarkup(i.mapping.map(n.before()),s)}t(i.scrollIntoView())}return!0};var x;const $=(e,t)=>(t&&t(e.tr.setSelection(new p(e.doc))),!0);function S(e,t,l){let a,p,f=t.nodeBefore,d=t.nodeAfter;if(f.type.spec.isolating||d.type.spec.isolating)return!1;if(function(e,t,n){let r=t.nodeBefore,l=t.nodeAfter,i=t.index();return!(!(r&&l&&r.type.compatibleContent(l.type))||(!r.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),0):!t.parent.canReplace(i,i+1)||!l.isTextblock&&!o(e.doc,t.pos)||(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),0)))}(e,t,l))return!0;let m=t.parent.canReplace(t.index(),t.index()+1);if(m&&(a=(p=f.contentMatchAt(f.childCount)).findWrapping(d.type))&&p.matchType(a[0]||d.type).validEnd){if(l){let r=t.pos+d.nodeSize,c=i.empty;for(let e=a.length-1;e>=0;e--)c=i.from(a[e].create(null,c));c=i.from(f.copy(c));let p=e.tr.step(new n(t.pos-1,r,t.pos,r,new s(c,1,0),a.length,!0)),u=r+2*a.length;o(p.doc,u)&&p.join(u),l(p.scrollIntoView())}return!0}let h=c.findFrom(t,1),g=h&&h.$from.blockRange(h.$to),k=g&&r(g);if(null!=k&&k>=t.depth)return l&&l(e.tr.lift(g,k).scrollIntoView()),!0;if(m&&u(d,"start",!0)&&u(f,"end")){let o=f,r=[];for(;r.push(o),!o.isTextblock;)o=o.lastChild;let c=d,a=1;for(;!c.isTextblock;c=c.firstChild)a++;if(o.canReplace(o.childCount,o.childCount,c.content)){if(l){let o=i.empty;for(let e=r.length-1;e>=0;e--)o=i.from(r[e].copy(o));l(e.tr.step(new n(t.pos-r.length,t.pos+d.nodeSize,t.pos+a,t.pos+d.nodeSize-a,new s(o,r.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function I(e){return function(t,n){let o=t.selection,r=e<0?o.$from:o.$to,l=r.depth;for(;r.node(l).isInline;){if(!l)return!1;l--}return!!r.node(l).isTextblock&&(n&&n(t.tr.setSelection(f.create(t.doc,e<0?r.start(l):r.end(l)))),!0)}}const M=I(-1),A=I(1);function V(t,n=null){return function(o,r){let{$from:l,$to:i}=o.selection,s=l.blockRange(i),c=s&&e(s,t,n);return!!c&&(r&&r(o.tr.wrap(s,c).scrollIntoView()),!0)}}function C(e,t=null){return function(n,o){let r=!1;for(let l=0;l<n.selection.ranges.length&&!r;l++){let{$from:{pos:o},$to:{pos:i}}=n.selection.ranges[l];n.doc.nodesBetween(o,i,((o,l)=>{if(r)return!1;if(o.isTextblock&&!o.hasMarkup(e,t))if(o.type==e)r=!0;else{let t=n.doc.resolve(l),o=t.index();r=t.parent.canReplaceWith(o,o+1,e)}}))}if(!r)return!1;if(o){let r=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:l},$to:{pos:i}}=n.selection.ranges[o];r.setBlockType(l,i,e,t)}o(r.scrollIntoView())}return!0}}function T(e,t=null){return function(n,o){let{empty:r,$cursor:l,ranges:i}=n.selection;if(r&&!l||!function(e,t,n){for(let o=0;o<t.length;o++){let{$from:r,$to:l}=t[o],i=0==r.depth&&e.inlineContent&&e.type.allowsMarkType(n);if(e.nodesBetween(r.pos,l.pos,(e=>{if(i)return!1;i=e.inlineContent&&e.type.allowsMarkType(n)})),i)return!0}return!1}(n.doc,i,e))return!1;if(o)if(l)e.isInSet(n.storedMarks||l.marks())?o(n.tr.removeStoredMark(e)):o(n.tr.addStoredMark(e.create(t)));else{let r=!1,l=n.tr;for(let t=0;!r&&t<i.length;t++){let{$from:o,$to:l}=i[t];r=n.doc.rangeHasMark(o.pos,l.pos,e)}for(let n=0;n<i.length;n++){let{$from:o,$to:s}=i[n];if(r)l.removeMark(o.pos,s.pos,e);else{let n=o.pos,r=s.pos,i=o.nodeAfter,c=s.nodeBefore,a=i&&i.isText?/^\s*/.exec(i.text)[0].length:0,p=c&&c.isText?/\s*$/.exec(c.text)[0].length:0;n+a<r&&(n+=a,r-=p),l.addMark(n,r,e.create(t))}}o(l.scrollIntoView())}return!0}}function z(...e){return function(t,n,o){for(let r=0;r<e.length;r++)if(e[r](t,n,o))return!0;return!1}}let B=z(d,((e,n,o)=>{let l=function(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}(e,o);if(!l)return!1;let i=m(l);if(!i){let t=l.blockRange(),o=t&&r(t);return null!=o&&(n&&n(e.tr.lift(t,o).scrollIntoView()),!0)}let p=i.nodeBefore;if(!p.type.spec.isolating&&S(e,i,n))return!0;if(0==l.parent.content.size&&(u(p,"end")||a.isSelectable(p))){let o=t(e.doc,l.before(),l.after(),s.empty);if(o&&o.slice.size<o.to-o.from){if(n){let t=e.tr.step(o);t.setSelection(u(p,"end")?c.findFrom(t.doc.resolve(t.mapping.map(i.pos,-1)),-1):a.create(t.doc,i.pos-p.nodeSize)),n(t.scrollIntoView())}return!0}}return!(!p.isAtom||i.depth!=l.depth-1)&&(n&&n(e.tr.delete(i.pos-p.nodeSize,i.pos).scrollIntoView()),!0)}),((e,t,n)=>{let{$head:o,empty:r}=e.selection,l=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):o.parentOffset>0)return!1;l=m(o)}let i=l&&l.nodeBefore;return!(!i||!a.isSelectable(i))&&(t&&t(e.tr.setSelection(a.create(e.doc,l.pos-i.nodeSize)).scrollIntoView()),!0)})),v=z(d,h,((e,t,n)=>{let{$head:o,empty:r}=e.selection,l=o;if(!r)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):o.parentOffset<o.parent.content.size)return!1;l=g(o)}let i=l&&l.nodeAfter;return!(!i||!a.isSelectable(i))&&(t&&t(e.tr.setSelection(a.create(e.doc,l.pos)).scrollIntoView()),!0)}));const R={Enter:z(k,((e,t)=>{let n=e.selection,{$from:o,$to:r}=n;if(n instanceof p||o.parent.inlineContent||r.parent.inlineContent)return!1;let l=w(r.parent.contentMatchAt(r.indexAfter()));if(!l||!l.isTextblock)return!1;if(t){let n=(!o.parentOffset&&r.index()<r.parent.childCount?o:r).pos,i=e.tr.insert(n,l.createAndFill());i.setSelection(f.create(i.doc,n+1)),t(i.scrollIntoView())}return!0}),((e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if(l(e.doc,o))return t&&t(e.tr.split(o).scrollIntoView()),!0}let o=n.blockRange(),i=o&&r(o);return null!=i&&(t&&t(e.tr.lift(o,i).scrollIntoView()),!0)}),b),"Mod-Enter":y,Backspace:B,"Mod-Backspace":B,"Shift-Backspace":B,Delete:v,"Mod-Delete":v,"Mod-a":$},O={"Ctrl-h":R.Backspace,"Alt-Backspace":R["Mod-Backspace"],"Ctrl-d":R.Delete,"Ctrl-Alt-Backspace":R["Mod-Delete"],"Alt-Delete":R["Mod-Delete"],"Alt-d":R["Mod-Delete"],"Ctrl-a":M,"Ctrl-e":A};for(let j in R)O[j]=R[j];const D=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&"darwin"==os.platform())?O:R;export{$ as a,D as b,z as c,d,y as e,h as j,k as n,C as s,T as t,V as w};
