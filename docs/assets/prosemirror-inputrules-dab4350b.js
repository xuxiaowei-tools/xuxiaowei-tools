import{a as t}from"./prosemirror-state-5b4308dd.js";class e{constructor(t,e){var s;this.match=t,this.match=t,this.handler="string"==typeof e?(s=e,function(t,e,r,n){let l=s;if(e[1]){let t=e[0].lastIndexOf(e[1]);l+=e[0].slice(t+e[1].length);let s=(r+=t)-n;s>0&&(l=e[0].slice(t-s,t)+l,r=n)}return t.tr.insertText(l,r,n)}):e}}const s=500;function r({rules:e}){let s=new t({state:{init:()=>null,apply(t,e){let s=t.getMeta(this);return s||(t.selectionSet||t.docChanged?null:e)}},props:{handleTextInput:(t,r,l,o)=>n(t,r,l,o,e,s),handleDOMEvents:{compositionend:t=>{setTimeout((()=>{let{$cursor:r}=t.state.selection;r&&n(t,r.pos,r.pos,"",e,s)}))}}},isInputRules:!0});return s}function n(t,e,r,n,l,o){if(t.composing)return!1;let a=t.state,i=a.doc.resolve(e);if(i.parent.type.spec.code)return!1;let c=i.parent.textBetween(Math.max(0,i.parentOffset-s),i.parentOffset,null,"ï¿¼")+n;for(let s=0;s<l.length;s++){let i=l[s].match.exec(c),p=i&&l[s].handler(a,i,e-(i[0].length-n.length),r);if(p)return t.dispatch(p.setMeta(o,{transform:p,from:e,to:r,text:n})),!0}return!1}const l=(t,e)=>{let s=t.plugins;for(let r=0;r<s.length;r++){let n,l=s[r];if(l.spec.isInputRules&&(n=l.getState(t))){if(e){let s=t.tr,r=n.transform;for(let t=r.steps.length-1;t>=0;t--)s.step(r.steps[t].invert(r.docs[t]));if(n.text){let e=s.doc.resolve(n.from).marks();s.replaceWith(n.from,n.to,t.schema.text(n.text,e))}else s.delete(n.from,n.to);e(s)}return!0}}return!1};export{e as I,r as i,l as u};
